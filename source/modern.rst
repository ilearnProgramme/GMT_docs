GMT现代模式
===========

**GMT现代模式是GMT6增加的新功能，也是GMT6相对于GMT5的最大变化！**

经典模式
--------

GMT命令存在的一些问题：

#. 大部分命令需要使用 ``-K`` ``-O`` ，而且极其容易出错
#. 每个绘图命令都需要使用重定向 ``>`` 或 ``>>``
#. 每个绘图命令中都需要给定PS文件的名字
#. 大部分命令都需要重复使用 ``-J`` 和 ``-R`` 选项
#. 在一张图上绘制多个子图时，需要多次使用 ``-X`` 和 ``-Y`` 调整原点位置
#. 绘制子图时需要使用 ``pstext`` 手动为子图添加标签 (a) (b) 等
#. 多个子图的总标题也需要调用 ``pstext`` 单独添加

例如下面这里示例：

.. literalinclude:: /scripts/classic_mode.sh

其生成图的如下所示：

.. figure:: /images/classic_mode.*
   :width: 600px
   :align: center

现代模式
--------

现代模式下的脚本如下所示：

.. literalinclude:: /scripts/modern_mode.sh

begin
+++++

::

    gmt begin [<prefix>] [<formats>] [-V<verbose>]

此命令会开启一个GMT会话，使得GMT运行在现代模式下。如果你的脚本只绘制一个图，
那么可以在该命令中直接指定图的文件名和图片格式。

``<prefix>``
    最终生成的图片的文件名，默认值为 ``gmtsession`` ，文件扩展名会根据 ``<formats>``
    自动给定

``<formats>``
    指定生成的图片的格式，可以指定多个格式，多个格式间用逗号分隔

    可以选择的格式如下表所示，默认为 ``pdf``

    +--------+-----------------------------------------+
    | Format | Explanation                             |
    +========+=========================================+
    |  bmp   | MicroSoft BitMap.                       |
    +--------+-----------------------------------------+
    |  eps   | Encapsulated *PostScript*               |
    +--------+-----------------------------------------+
    |  jpg   | Joint Photographic Experts Group format |
    +--------+-----------------------------------------+
    |  pdf   | Portable Document Format [Default]      |
    +--------+-----------------------------------------+
    |  png   | Portable Network Graphics               |
    +--------+-----------------------------------------+
    |  ppm   | Portable Pixel Map                      |
    +--------+-----------------------------------------+
    |   ps   | Plain *PostScript*                      |
    +--------+-----------------------------------------+
    |   tif  | Tagged Image Format File                |
    +--------+-----------------------------------------+

figure
++++++

::

    gmt figure <prefix> [<formats>] [<options>] [-V<verbose>]

一个GMT会话中可以绘制多张图，此命令用于告诉GMT当前图的文件名和格式。
该命令必须在绘图前执行，且每次执行该命令都会终止前一张图并开始下一张图。

``<prefix>``
    最终生成的图片的文件名，文件后缀会根据 ``<formats>`` 自定给定

``<formats>``
    指定生成的图片的格式，默认为pdf格式，可以指定多个格式，多个格式间用逗号分隔

``<options>``
    一个或多个以逗号分隔的传递给 ``psconvert`` 模块的选项，默认为为 ``A,P`` 。
    即在绘图结束时会自动执行 ``gmt psconvert -A -P xxx`` 选项将图片转换为其他格式

    可用的选项包括：

    - ``A[<args>]``
    - ``C<args>``
    - ``D<dir>``
    - ``E<dpi>``
    - ``P``
    - ``Q<args>``
    - ``S``

    选项的含义见 ``psconvert`` 模块的文档。

subplot
+++++++

``gmt subplot`` 用于将当前图片切割成多个子图构成的矩阵，每个矩阵内包含一张子图。

``gmt subplot begin`` 用于定义子图的布局和整体属性::

    gmt subplot begin <nrows>x<ncols>
        -F[f|s]<width>/<height>
        [-A<autolabel>]
        [-B<params>]
        [-C<side><clearance>[u]]
        [-D[x][y]]
        [-J<params>]
        [-SC<layout>][+<mods>]
        [-SR<layout>][+<mods>]
        [-M<margins>]
        [-R<params>]
        [-T<heading>]
        [-V<verbose>]

``<nrows>x<ncols>``
    指定子图的行数和列数。

    这种情况下，每行的子图数目是相同的。若想要每行有不同的子图数目，则需要多次
    调用 ``subplots`` 命令。

``-F[f|s]<width>/<height>``
    设置图片的尺寸。

    有两种指定图片尺寸的方式：直接指定整张图片的尺寸或者分别指定每个面板（子图）的尺寸。

``-Ff<width>/<height>[:<wfracs>/[<hfracs>]]``
    直接指定整张图片的尺寸，再根据整张图片的大小，并考虑到标注、刻度等占据的空间
    自动计算每张子图的尺寸。

    若想要为每行或每列分别指定不同的尺寸，则可以在尺寸后面加上一个冒号，然后加上
    一系列以逗号分隔的宽度比例，再加上一个斜线，再加上一系列以逗号分隔的高度比例。

    例如， ``-Ff4i/4i:3,1/1,2`` 表示整张图的宽度和高度都是4英寸，第一列的宽度是
    第二列宽度的3倍，而第二行的高度是第一行高度的2倍。


``-Fs<widths>/<heights>``
    直接指定每张子图的尺寸。整张图片的大小会根据每张子图的尺寸以及子图的标注、
    刻度等所占据的空间自动计算。

    在这种情况下，所有图的最外面一边的标注和刻度所占据的空间不会算作整张图片
    尺寸的一部分。

    若想要为每张子图指定不同的尺寸，可以直接给定以逗号分隔的宽度列表和高度列表。

    例如， ``-Fs2i,3i/3i`` 设置了第1列宽度为2英寸，第2列宽度为3英寸，而所有行的
    高度都是3英寸。参数中给出的宽度和高度数目必须是1个，或者严格等于当前图中的
    行数或列数。

    对于地图而言，子图的高度由投影方式和绘图区域范围决定。此时有两种方式可以选择：

    #. 同时指定 ``-R`` 和 ``-J`` 选项，由程序自动计算每张子图的高度。此时所有子图
       必须共用相同的区域范围和投影方式，且需要指定子图高度为0
    #. 通过不断人工调整 ``<height>`` 来获取最佳的子图布局

``-A<autolabel>``
    对每个子图自动标号。 ``<autolabel>`` 可以取数字或字母，默认值为 ``a`` 。

    该命令设置了左上角第一个子图的编号，其余子图会依次编号。还可以在标号的周围
    加上括号使得其显示为 ``(a)`` 格式（需要注意，UNIX下括号具有特殊含义，因而
    可能需要进行转义）。

    - ``+j|J<refpoint>`` 以指定标号在子图中的位置，默认值为 ``TL`` 即左上角。
      ``+j`` 通常用于标号位于图框内的情况， ``+J`` 常用于标号位于图框外的情况。
    - ``+c<dx>[/<dy>]`` 设置标号与文本框之间的空白区域，可以直接指定大小，也可以
      指定相对于当前字体大小的百分比
    - ``+o<dx>[<dy>]`` 标号相对于参考点的偏移量，默认值为当前标号字体大小的20%
    - ``+g`` 标号的文本框的填充色，默认不填充
    - ``+p`` 绘制标号的文本框
    - ``+r|R`` 用小写/大写罗马数字标号，默认使用阿拉伯数字标号
    - ``+v`` 垂直向下按列增加标号的值，默认是水平方向递增

    标号的文字大小由参数 ``FONT_TAG`` 控制。

``-C<side><clearance>[u]]``
    指定子图的上下左右各边剩余空白距离的大小。

    ``<side>`` 可以取 ``w|e|s|n`` 。该选项可重复使用，以分别指定不同边的空白距离。

``-S[R|C]``
    设置子图行或列的布局

``-SC``
    每个子图列共享一个公用的X轴范围，最上面一行的上坐标轴和最下面一行的下坐标轴
    都会加上标注。

    - 加上 ``t`` 或 ``b`` 表示只标注这两个轴中的某一个。
    - ``+l[<label>]`` 表示X轴需要有标签
    - ``+t`` 为所有子图各自的标题留下空间
    - ``+tc`` 只为最上面一行的子图标题留下空间

``-SR``
    每个子图行共享一个公用的Y轴范围。最左边一列的左坐标轴和最右边一列的坐标轴
    都会加上标注。

    - 加上 ``l`` 或 ``r`` 表示只标注这两个轴中的某一个。
    - ``+l[<label>]`` 表示Y轴需要有标签
    - ``+p`` 表示Y轴标注需要平行于Y坐标轴

``-M<margins>``
    在每个子图的周围加上空白区域，默认值为 0.5c

    - ``<margin>`` 四边有相同的空白区域
    - ``<xmargin>/<ymargin>`` X和Y方向分别有不同的空白区域
    - ``<wmargin>/<emargin>/<smargin>/<nmargin>`` 四边分别有不同的空白区域

``-T<heading>``
    每张子图都可以有自己的标题，整张图也可以有一个总标题。该选项用于设置整张图的
    总标题。总标题的字体大小由 ``FONT_HEADING`` 控制。

::

    gmt subplot <row>,<col> [-A<tag>] [-C<side><clearance>[u]] [-V<verbose>]

``<row>,<col>``
    指定当前绘图在哪个子图区域内进行绘制

``-A<tag>``
    手动指定当前子图的编号，而不是使用之前设置的自动编号

::

    gmt subplot end [-V<verbose>]

退出子图模式，并经绘图起点回到子图开始之前的位置。

revert
++++++

::

    gmt revert [<n>|all] [-V<verbose>]

该命令会擦除当前图片的最近 n 个图层， ``all`` 表示擦除整个图片的所有内容。

end
+++

::

    gmt end [-V<verbose>]

该命令用于结束现代模式，完成所有相关图片的绘制工作，并将图片置于当前目录。
